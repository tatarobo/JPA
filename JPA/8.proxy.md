
# 8. 프록시와 연관관계 관리

# 8.1 프록시

* 엔티티를 조회할 때 연관된 엔티티들이 항상 조회되는 것은 아님
* JPA는 엔티티가 실제 사용될 때까지 데이터베이스에서 조회를 지연시키는 방법을 제공 -> 지연 로딩
* 프록시 객체
	* 실제 엔티티 객체 대신에 데이터베이스 조회를 지연할 수 있는 가짜 객체

### EntityManager.getReference() 메소드
```java
Member member = em.getReference(Member.class, "member1");
```
* 메소드 호출 시, 데이터베이스를 조회하지 않고 실제 엔티티 객체도 생성하지 않는다.
* 대신, 프록시 객체 반환

### 프록시의 특징
```
						---------
						Entity
						---------
						id
						name
						---------
						getId()
						getName()
						---------
						    ^
						    |
						    |
						---------
						Proxy
						---------
						---------
						getId()
						getName()
						---------

```
* 프록시 클래스는 실제 클래스를 상속 받아서 생성
```
-------------					---------
Proxy							Entity
-------------					---------
Entity target	---------->		id
-------------					name
getId()							---------
getName()						getId()
-------------					getName()
								---------
```
* 프록시 객체는 실제 객체에 대한 참조 보관

### 프록시 객체의 초기화 과정

1. member.getName() 호출을 통해 실제 데이터 조회 (member는 proxy 객체)
2. 프록시 객체는 실제 엔티티가 생성되어 있지 않으면 영속성 컨텍스트에 실제 엔티티 생성을 요청(프록시 객체의 target이 NULL일 시) -> 초기화
3. 영속성 컨텍스트는 데이터 베이스를 조회해서 실제 엔티티 객체 생성
4. 프록시 객체는 생성된 실제 엔티티 객체의 참조를 target 멤버 변수에 보관
5. 프록시 객체는 실제 엔티티 객체의 getName을 호출해서 결과를 반환

### 프록시의 특징

* 프록시




```bash
#aldkfjalsdjfalskdf
sleep 10
tmboot -T
if [ "$HOME" = "" ];then
fi

```

* asdfjladsf `lajsdflkjas` asldkfjadslkfj 
* 

| wpahr | gkgkgk|
|--:|--|
| rkskek | alskdfsd
| adsf|
|asfasdadsfasdf | asdfsdf

> asdfaldkfjasldf
> 

* [ ] sdfasdf
* [x] asdfasdf	
	* [ ] asdfasdf
		* [x] asdf	

> Written with [StackEdit](https://stackedit.io/).
<!--stackedit_data:
eyJoaXN0b3J5IjpbMTQwNzQ5Njg4OCwxMzU2OTk3ODEzLDIwOT
MwMTg2OTUsLTc5MjA1NDA1NiwxMTk3MDUyODE5LDExMjg0MDM2
MTMsLTE0MDQxMzkwMzVdfQ==
-->